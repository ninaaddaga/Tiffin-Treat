<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiffin Treats | Cloud API Delivery</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        /* CSS remains same as aesthetic version for consistency */
        :root { --accent-green: #2ecc71; --dark-green: #1b4d3e; --glass: rgba(255, 255, 255, 0.94); }
        body { font-family: 'Poppins', sans-serif; margin: 0; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1543353071-873f17a7a088?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80'); background-size: cover; background-attachment: fixed; min-height: 100vh; }
        header { background: var(--glass); backdrop-filter: blur(10px); padding: 15px 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 1000; }
        .container { max-width: 500px; margin: 30px auto; padding: 25px; background: var(--glass); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .btn { background: var(--dark-green); color: white; border: none; padding: 12px 25px; border-radius: 50px; cursor: pointer; width: 100%; margin-top: 15px; font-weight: 600; }
        .hidden { display: none; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<header>
    <h1 style="color: var(--dark-green); margin: 0;">üåø Tiffin Treats</h1>
</header>

<div id="menu-page" class="container">
    <h2>Menu</h2>
    <div style="display:flex; justify-content:space-between; margin-bottom: 20px;">
        <span>Standard Veg Thali (‚Çπ120)</span>
        <button onclick="addToCart('Veg Thali', 120)" style="border-radius: 5px;">+ Add</button>
    </div>
    <button class="btn" onclick="showPage('checkout-page')">Checkout</button>
</div>

<div id="checkout-page" class="container hidden">
    <h2>Order Details</h2>
    <input type="text" id="userName" placeholder="Your Name">
    <textarea id="userAddress" placeholder="Delivery Address"></textarea>
    <button class="btn" onclick="sendWhatsAppAPI()">Confirm & Pay</button>
</div>

<div id="success-page" class="container hidden" style="text-align: center;">
    <h2>Order Sent! üåø</h2>
    <p>Your order has been sent directly to our kitchen via WhatsApp Cloud API.</p>
    <button class="btn" onclick="location.reload()">Order Again</button>
</div>

<script>
    // --- CLOUD API CONFIGURATION ---
    const WHATSAPP_TOKEN = "YOUR_ACCESS_TOKEN"; // Replace with your Meta Token
    const PHONE_NUMBER_ID = "YOUR_PHONE_NUMBER_ID"; // Replace with your ID
    const RECIPIENT_NUMBER = "91XXXXXXXXXX"; // Your phone number with country code

    let cart = [];

    function addToCart(name, price) {
        cart.push({name, price});
        alert(name + " added!");
    }

    function showPage(pageId) {
        document.querySelectorAll('.container').forEach(p => p.classList.add('hidden'));
        document.getElementById(pageId).classList.remove('hidden');
    }

    async function sendWhatsAppAPI() {
        const name = document.getElementById('userName').value;
        const address = document.getElementById('userAddress').value;

        if(!name || !address) return alert("Please fill details");

        const orderText = cart.map(item => item.name).join(", ");
        
        // WhatsApp Cloud API Payload
        // Note: Using a "text" message. For production, Meta usually requires "template" messages for business-initiated chats.
        const url = `https://graph.facebook.com/v17.0/${PHONE_NUMBER_ID}/messages`;
        
        const data = {
            messaging_product: "whatsapp",
            to: RECIPIENT_NUMBER,
            type: "text",
            text: {
                body: `üç± *New Order: Tiffin Treats*\n\nCustomer: ${name}\nAddress: ${address}\nItems: ${orderText}`
            }
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${WHATSAPP_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                showPage('success-page');
            } else {
                const err = await response.json();
                console.error(err);
                alert("Error sending WhatsApp: " + err.error.message);
            }
        } catch (error) {
            console.error(error);
            alert("Connection failed.");
        }
    }
</script>
</body>
</html>
